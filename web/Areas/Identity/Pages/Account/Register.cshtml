@page
@model RegisterModel
@{
    ViewData["Title"] = "Create Account";
}
<div class="home-hero-new sb-hero sb-hero-compact mb-4" style="justify-content: flex-start;">
    <div class="home-hero-text">
        <h1 class="home-hero-title">Create Your Account</h1>
        <p class="home-hero-subtitle">Join StudyBuddy and start learning together.</p>
    </div>
</div>

<div class="row g-4">


    <div class="col-md-8 mx-auto">
        <div class="home-info-card sb-card p-4 p-md-4">

            <h2 class="home-info-title">Sign Up</h2>

            <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post">

                <div asp-validation-summary="ModelOnly" class="text-danger mb-2"></div>

                <div class="mb-3">
                    <label asp-for="Input.Name" class="form-label"></label>
                    <input asp-for="Input.Name" class="form-control login-input" />
                    <span asp-validation-for="Input.Name" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Input.Email" class="form-label"></label>
                    <input asp-for="Input.Email" class="form-control login-input" autocomplete="username" />
                    <span asp-validation-for="Input.Email" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Input.Password" class="form-label"></label>
                    <input asp-for="Input.Password" class="form-control login-input" autocomplete="new-password" />
                    <span asp-validation-for="Input.Password" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Input.ConfirmPassword" class="form-label"></label>
                    <input asp-for="Input.ConfirmPassword" class="form-control login-input" autocomplete="new-password" />
                    <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Input.Description" class="form-label"></label>
                    <textarea asp-for="Input.Description" class="form-control login-input"></textarea>
                    <span asp-validation-for="Input.Description" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Input.FacultyId" class="form-label">Faculty</label>
                    <select asp-for="Input.FacultyId"
                            asp-items="Model.FacultyOptions"
                            class="form-control login-input">
                        <option value="">-- Select Faculty --</option>
                    </select>
                    <span asp-validation-for="Input.FacultyId" class="text-danger"></span>
                </div>


                <div class="form-check mb-3">
                    <input asp-for="Input.IsTutor" class="form-check-input" id="isTutorCheckbox" />
                    <label asp-for="Input.IsTutor" class="form-check-label"></label>
                </div>


                <div id="tutorSubjectsSection" style="display:none">

                    <label class="fw-bold">Subjects You Teach</label>


                    <div class="d-flex gap-2 align-items-center my-2">
                        <select id="availableSubjects" class="form-control">
                            <option value="">-- Select Subject --</option>

                            @foreach (var s in Model.SubjectOptions)
                            {
                                <option value="@s.Value">@s.Text</option>
                            }
                        </select>

                        <button type="button" id="addSubjectBtn" class="btn btn-secondary">
                            Add
                        </button>
                    </div>


                    <div id="selectedSubjectsContainer" class="mt-3"></div>


                    <div id="hiddenInputs"></div>

                    <span asp-validation-for="Input.SubjectIds" class="text-danger"></span>
                </div>

                <button type="submit" class="login-btn w-100 mt-3">Create Account</button>

                <div class="login-links mt-3 text-center">
                    <a asp-page="./Login" asp-route-returnUrl="@Model.ReturnUrl">
                        Already have an account? Log in
                    </a>
                </div>

            </form>
        </div>
    </div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        const isTutorCheckbox = document.getElementById("isTutorCheckbox");
        const tutorSection = document.getElementById("tutorSubjectsSection");
        const availableSubjects = document.getElementById("availableSubjects");
        const addSubjectBtn = document.getElementById("addSubjectBtn");
        const selectedContainer = document.getElementById("selectedSubjectsContainer");
        const hiddenInputs = document.getElementById("hiddenInputs");

        function toggleTutorSection() {
            tutorSection.style.display = isTutorCheckbox.checked ? "block" : "none";
        }

        toggleTutorSection();
        isTutorCheckbox.addEventListener("change", toggleTutorSection);

        function addSubject() {
            const subjectId = availableSubjects.value;
            const subjectName = availableSubjects.options[availableSubjects.selectedIndex]?.text;

            if (!subjectId) return;

            availableSubjects.remove(availableSubjects.selectedIndex);

            createSubjectRow(subjectId, subjectName);

            availableSubjects.value = "";
        }

        function createSubjectRow(id, name) {
            const row = document.createElement("div");
            row.className = "d-flex justify-content-between align-items-center border p-2 mb-2";
            row.dataset.id = id;

            row.innerHTML = `
                <span>${name}</span>
                <button type="button" class="btn btn-danger btn-sm">Remove</button>
            `;

            const hidden = document.createElement("input");
            hidden.type = "hidden";
            hidden.name = "Input.SubjectIds";
            hidden.value = id;
            hidden.dataset.id = id;

            hiddenInputs.appendChild(hidden);

            row.querySelector("button").addEventListener("click", () => {
                row.remove();
                hidden.remove();

                const opt = document.createElement("option");
                opt.value = id;
                opt.text = name;
                availableSubjects.appendChild(opt);
            });

            selectedContainer.appendChild(row);
        }

        addSubjectBtn.addEventListener("click", addSubject);
    </script>
}
